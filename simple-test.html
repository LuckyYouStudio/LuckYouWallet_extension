<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckYou Wallet æ£€æµ‹æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .debug-info {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ LuckYou Wallet æ£€æµ‹æµ‹è¯•</h1>
        
        <div id="status">
            <div class="status info">æ­£åœ¨æ£€æµ‹é’±åŒ…æ‰©å±•...</div>
        </div>
        
        <div class="debug-info">
            <strong>é¡µé¢ä¿¡æ¯:</strong><br>
            URL: <span id="pageUrl"></span><br>
            åè®®: <span id="pageProtocol"></span><br>
            ä¸»æœº: <span id="pageHost"></span>
        </div>
        
        <div class="debug-info">
            <strong>é’±åŒ…çŠ¶æ€:</strong><br>
            window.ethereum: <span id="ethereumStatus">æ£€æŸ¥ä¸­...</span><br>
            window.luckyouWallet: <span id="luckyouWalletStatus">æ£€æŸ¥ä¸­...</span><br>
            window.web3: <span id="web3Status">æ£€æŸ¥ä¸­...</span>
        </div>
        
        <button onclick="checkExtension()">é‡æ–°æ£€æŸ¥æ‰©å±•</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        
        <h3>è¯¦ç»†æ—¥å¿—:</h3>
        <div id="log" class="log"></div>
    </div>

    <script>
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            updateLog();
            console.log(logEntry);
        }
        
        function updateLog() {
            const logDiv = document.getElementById('log');
            logDiv.textContent = logs.join('\n');
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            logs = [];
            updateLog();
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateDebugInfo() {
            document.getElementById('pageUrl').textContent = window.location.href;
            document.getElementById('pageProtocol').textContent = window.location.protocol;
            document.getElementById('pageHost').textContent = window.location.host;
            
            // æ›´æ–°é’±åŒ…çŠ¶æ€
            const ethereumStatus = window.ethereum ? 
                `å­˜åœ¨: ${window.ethereum.isMetaMask ? 'MetaMask' : (window.ethereum.isLuckYouWallet ? 'LuckYou Wallet' : 'å…¶ä»–')}` : 
                'ä¸å­˜åœ¨';
            document.getElementById('ethereumStatus').textContent = ethereumStatus;
            
            const luckyouWalletStatus = window.luckyouWallet ? 
                `å­˜åœ¨: ${window.luckyouWallet.isLuckYouWallet ? 'LuckYou Wallet' : 'å…¶ä»–'}` : 
                'ä¸å­˜åœ¨';
            document.getElementById('luckyouWalletStatus').textContent = luckyouWalletStatus;
            
            const web3Status = window.web3 ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨';
            document.getElementById('web3Status').textContent = web3Status;
        }
        
        function checkExtension() {
            log('å¼€å§‹æ£€æŸ¥æ‰©å±•çŠ¶æ€...');
            updateDebugInfo();
            
            let luckYouFound = false;
            let detectionMethod = '';
            
            // æ£€æŸ¥ window.ethereum
            if (window.ethereum) {
                log('âœ… window.ethereum å­˜åœ¨');
                log(`   ç±»å‹: ${typeof window.ethereum}`);
                log(`   isMetaMask: ${window.ethereum.isMetaMask}`);
                log(`   isLuckYouWallet: ${window.ethereum.isLuckYouWallet}`);
                
                if (window.ethereum.isLuckYouWallet) {
                    luckYouFound = true;
                    detectionMethod = 'window.ethereum';
                    updateStatus('ğŸ‰ æ£€æµ‹åˆ° LuckYou Wallet (é€šè¿‡ window.ethereum)', 'success');
                    log('ğŸ‰ æ£€æµ‹åˆ° LuckYou Wallet (é€šè¿‡ window.ethereum)');
                } else if (window.ethereum.isMetaMask) {
                    log('ğŸ¦Š æ£€æµ‹åˆ° MetaMask');
                } else {
                    log('â“ æœªçŸ¥çš„ ethereum provider');
                }
            } else {
                log('âŒ window.ethereum ä¸å­˜åœ¨');
            }
            
            // æ£€æŸ¥ window.luckyouWallet
            if (window.luckyouWallet) {
                log('âœ… window.luckyouWallet å­˜åœ¨');
                log(`   ç±»å‹: ${typeof window.luckyouWallet}`);
                log(`   isLuckYouWallet: ${window.luckyouWallet.isLuckYouWallet}`);
                
                if (window.luckyouWallet.isLuckYouWallet) {
                    luckYouFound = true;
                    detectionMethod = 'window.luckyouWallet';
                    updateStatus('ğŸ‰ æ£€æµ‹åˆ° LuckYou Wallet (é€šè¿‡ window.luckyouWallet)', 'success');
                    log('ğŸ‰ æ£€æµ‹åˆ° LuckYou Wallet (é€šè¿‡ window.luckyouWallet)');
                } else {
                    log('âš ï¸ window.luckyouWallet å­˜åœ¨ä½†ä¸æ˜¯ LuckYou Wallet');
                }
            } else {
                log('â„¹ï¸ window.luckyouWallet ä¸å­˜åœ¨');
            }
            
            // æ£€æŸ¥ window.web3
            if (window.web3) {
                log('âœ… window.web3 å­˜åœ¨');
                log(`   ç±»å‹: ${typeof window.web3}`);
            } else {
                log('â„¹ï¸ window.web3 ä¸å­˜åœ¨');
            }
            
            if (!luckYouFound) {
                updateStatus('âŒ æœªæ£€æµ‹åˆ° LuckYou Wallet æ‰©å±•', 'error');
                log('âŒ æœªæ£€æµ‹åˆ° LuckYou Wallet æ‰©å±•');
                log('è¯·ç¡®ä¿ï¼š');
                log('1. å·²å®‰è£… LuckYou Wallet æ‰©å±•');
                log('2. æ‰©å±•å·²å¯ç”¨');
                log('3. é¡µé¢å·²é‡æ–°åŠ è½½');
            } else {
                log(`âœ… LuckYou Wallet æ£€æµ‹æˆåŠŸï¼æ£€æµ‹æ–¹å¼: ${detectionMethod}`);
            }
        }
        
        async function testConnection() {
            log('å¼€å§‹æµ‹è¯•é’±åŒ…è¿æ¥...');
            
            try {
                let provider = null;
                
                // ä¼˜å…ˆä½¿ç”¨ luckyouWallet
                if (window.luckyouWallet && window.luckyouWallet.isLuckYouWallet) {
                    provider = window.luckyouWallet;
                    log('ä½¿ç”¨ window.luckyouWallet è¿›è¡Œæµ‹è¯•');
                } else if (window.ethereum && window.ethereum.isLuckYouWallet) {
                    provider = window.ethereum;
                    log('ä½¿ç”¨ window.ethereum è¿›è¡Œæµ‹è¯•');
                } else {
                    log('âŒ æ²¡æœ‰æ‰¾åˆ° LuckYou Wallet provider');
                    return;
                }
                
                // æµ‹è¯•åŸºæœ¬æ–¹æ³•
                log('æµ‹è¯• requestAccounts...');
                const accounts = await provider.requestAccounts();
                log(`âœ… è·å–åˆ°è´¦æˆ·: ${accounts.length} ä¸ª`);
                
                if (accounts.length > 0) {
                    log(`ç¬¬ä¸€ä¸ªè´¦æˆ·: ${accounts[0]}`);
                }
                
                log('æµ‹è¯• getChainId...');
                const chainId = await provider.getChainId();
                log(`âœ… é“¾ID: ${chainId}`);
                
                updateStatus('ğŸ‰ é’±åŒ…è¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
                
            } catch (error) {
                log(`âŒ è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`);
                updateStatus('âŒ é’±åŒ…è¿æ¥æµ‹è¯•å¤±è´¥', 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            updateDebugInfo();
            setTimeout(() => {
                log('å»¶è¿Ÿæ£€æŸ¥æ‰©å±•...');
                checkExtension();
            }, 1000);
        });
        
        // ç›‘å¬ ethereum#initialized äº‹ä»¶
        window.addEventListener('ethereum#initialized', () => {
            log('ğŸ‰ æ£€æµ‹åˆ° ethereum#initialized äº‹ä»¶');
            setTimeout(() => {
                log('äº‹ä»¶è§¦å‘åæ£€æŸ¥æ‰©å±•...');
                checkExtension();
            }, 500);
        });
        
        // å®šæœŸæ£€æŸ¥
        let checkInterval = setInterval(() => {
            if (window.luckyouWallet || (window.ethereum && window.ethereum.isLuckYouWallet)) {
                log('âœ… æ£€æµ‹åˆ° LuckYou Walletï¼Œåœæ­¢å®šæœŸæ£€æŸ¥');
                clearInterval(checkInterval);
                checkExtension();
            }
        }, 1000);
        
        // 10ç§’ååœæ­¢æ£€æŸ¥
        setTimeout(() => {
            clearInterval(checkInterval);
            log('â° å®šæœŸæ£€æŸ¥è¶…æ—¶');
        }, 10000);
    </script>
</body>
</html>
